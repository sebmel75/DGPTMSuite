{
    "title": "Umfragen",
    "description": "Generisches Umfrage-Framework mit erweiterten Fragetypen, Skip-Logic, Verschachtelung, Frontend-Editor und Ergebnis-Dashboard.",
    "content": "# DGPTM Umfragen\n\n## Übersicht\n\nGenerisches Umfrage-Framework für strukturierte Befragungen. Unterstützt 8 Fragetypen, Skip-Logic, Fragen-Verschachtelung (Nesting), Duplikatschutz, Datei-Uploads, Frontend-Editor, PDF-Export, Token-basierte URLs und Ergebnis-Dashboard. Die erste mitgelieferte Umfrage ist die ECLS-Zentren-Erhebung (15 Fragen zu ECMO/ECLS-Programmen).\n\n## Hauptfunktionen\n\n- 8 Fragetypen: Text, Textarea, Zahl, Radio, Checkbox, Select, Matrix, Datei-Upload\n- Skip-Logic (bedingte Verzweigung)\n- Fragen-Verschachtelung (Elternfrage → Kindfragen, mehrstufig)\n- Duplikatschutz (Cookie + IP-Adresse)\n- Fortschrittsbalken mit Abschnitts-Navigation\n- Zwischenspeichern und Fortsetzen\n- Ergebnis-Dashboard mit Balkendiagrammen, Heatmaps und Statistiken\n- CSV-Export und PDF-Export aller Antworten\n- Öffentlicher Ergebnis-Link (Token-basiert)\n- Token-basierte Umfrage-URLs für direkten Zugang\n- Frontend-Editor für berechtigte Benutzer\n- ECLS-Zentren Musterumfrage (15 Fragen, vorkonfiguriert)\n- Datei-Upload mit automatischem Cleanup\n\n## Shortcodes\n\n### [dgptm_umfrage]\nBindet eine Umfrage auf einer WordPress-Seite ein.\n\n**Parameter:**\n- `id` - Umfrage-ID (Zahl)\n- `slug` - Umfrage-Slug (Text)\n\nOhne Parameter: Erkennt die Umfrage automatisch aus dem GET-Parameter `?survey={token}`.\n\n**Beispiele:**\n```\n[dgptm_umfrage id=\"1\"]\n[dgptm_umfrage slug=\"ecls-zentren\"]\n```\n\n### [umfrageberechtigung]\nGibt \"1\" zurück wenn der aktuelle Benutzer Umfragen verwalten darf, sonst \"0\". Nützlich für Elementor Dynamic Visibility.\n\n### [dgptm_umfrage_editor]\nRendert den Frontend-Editor für Umfragen. Erfordert eingeloggten Benutzer mit Berechtigung (ACF-Feld `umfragen=true` oder `manage_options`). Zeigt sonst \"Kein Zugriff\".\n\n## Berechtigungssystem\n\nUmfragen können von folgenden Benutzern verwaltet werden:\n- WordPress-Administratoren (`manage_options`)\n- Benutzer mit ACF-Feld `umfragen = true` (oder User-Meta `umfragen = 1`)\n\nDas ECLS-Seed bleibt Admin-only.\n\n## Fragen-Verschachtelung (Nesting)\n\nNeu in v1.1: Fragen können einer Elternfrage zugeordnet werden. Die Kindfrage wird nur angezeigt, wenn die Elternfrage einen bestimmten Wert hat.\n\n### Konfiguration im Fragen-Builder\n\n1. Bei einer Frage \"Elternfrage\" aus dem Dropdown wählen\n2. \"Sichtbar wenn Antwort =\" eingeben (z.B. \"Ja\")\n3. Die Frage wird nur angezeigt wenn die Elternfrage diesen Wert hat\n\n### Mehrstufige Verschachtelung\n\nKindfragen können selbst Elternfragen sein (Q1 → Q2 → Q3). Wenn Q1 nicht beantwortet ist, werden Q2 und Q3 automatisch ausgeblendet (kaskadierende Sichtbarkeit).\n\n### Unterschied zu Skip-Logic\n\n- **Skip-Logic:** Überspringt Fragen und springt zu einer bestimmten Frage\n- **Verschachtelung:** Blendet Kindfragen ein/aus basierend auf der Elternfrage-Antwort\n\nBeide Mechanismen können gleichzeitig in einer Umfrage verwendet werden.\n\n## Token-basierte Umfrage-URLs\n\nJede Umfrage erhält automatisch einen eindeutigen Token. Der Umfrage-Link kann über eine konfigurierte WordPress-Seite aufgerufen werden:\n\n```\nhttps://perfusiologie.de/umfragen-seite/?survey={token}\n```\n\n### Konfiguration\n\n1. WordPress-Seite erstellen mit Shortcode `[dgptm_umfrage]` (ohne Parameter)\n2. DGPTM Suite → Modul-Einstellungen → Umfragen → \"Umfrage-Seiten-ID\" eintragen\n3. Der Shortcode erkennt die Umfrage automatisch aus dem GET-Parameter\n\n### Umfrage-Link kopieren\n\nDen Link finden Sie:\n- In der Umfrage-Liste (Spalte \"Umfrage-Link\")\n- Im Umfrage-Editor (unter dem Ergebnis-Link)\n\n## Frontend-Editor\n\nBerechtigte Benutzer können Umfragen direkt im Frontend erstellen und bearbeiten.\n\n### Einrichtung\n\n1. WordPress-Seite erstellen\n2. Shortcode `[dgptm_umfrage_editor]` einbinden\n3. Benutzer benötigt ACF-Feld `umfragen = true`\n\n### Funktionen\n\n**Listenansicht:**\n- Übersicht aller eigenen Umfragen (Admins sehen alle)\n- Status-Badge, Antwort-Anzahl\n- Buttons: Bearbeiten, Umfrage-Link kopieren, Ergebnis-Link kopieren\n- \"Neue Umfrage\" erstellen\n\n**Bearbeitungsansicht:**\n- Umfrage-Einstellungen (Titel, Beschreibung, Status, etc.)\n- Vollständiger Fragen-Builder (alle 8 Typen)\n- Skip-Logic und Verschachtelung\n- Drag & Drop Sortierung\n- Speichern per AJAX\n\n## PDF-Export\n\nNeu in v1.1: Umfrage-Ergebnisse können als PDF exportiert werden.\n\n### Inhalt\n\n- Titelseite: Umfrage-Titel, Beschreibung, Anzahl Antworten, Zeitraum\n- Pro Frage: Fragetext + aggregierte Ergebnisse\n  - Radio/Checkbox/Select: Liste mit Anzahl und Prozentwerten\n  - Zahl: Min, Max, Durchschnitt, Median\n  - Matrix: Tabelle mit Werten\n  - Text/Textarea: Liste der Antworten\n  - Datei: Anzahl\n\n### Verwendung\n\nIm Ergebnis-Dashboard neben dem CSV-Export-Button auf \"PDF Export\" klicken.\n\n## Admin-Interface\n\n**Menü:** DGPTM Suite → Umfragen\n\n### Umfrage-Liste\n\nÜbersicht aller Umfragen mit Status, Antwort-Anzahl, Shortcode, Umfrage-Link und Aktionen:\n- **Bearbeiten** - Umfrage-Einstellungen und Fragen\n- **Ergebnisse** - Auswertungs-Dashboard\n- **Duplizieren** - Kopie der Umfrage erstellen\n- **Ergebnis-Link** - Öffentlichen Link kopieren\n- **Umfrage-Link** - Token-basierten Umfrage-Link kopieren\n- **Archivieren** - Umfrage ausblenden\n\n### Umfrage erstellen/bearbeiten\n\n**Einstellungen:**\n- Titel und Slug\n- Beschreibung\n- Status: Entwurf / Aktiv / Geschlossen\n- Zugang: Öffentlich / Nur mit Token / Nur eingeloggt\n- Duplikatschutz: Cookie+IP / Nur Cookie / Nur IP / Kein Schutz\n- Fortschrittsbalken ein/aus\n- Zwischenspeichern ein/aus\n\n**Fragen-Builder:**\n- Fragen per Drag & Drop sortieren\n- Fragetyp wählen, Fragetext eingeben\n- Antwortoptionen für Radio/Checkbox/Select hinzufügen\n- Matrix: Zeilen und Spalten definieren\n- Validierung: Pflichtfeld, Min/Max (Zahlen), Pattern (E-Mail/URL/Telefon)\n- Skip-Logic: \"Wenn Antwort = X → Springe zu Frage Y\"\n- Verschachtelung: Elternfrage wählen + Antwort-Bedingung\n- Abschnitts-Label für Gruppierung\n\n### Ergebnis-Dashboard\n\n**Übersicht:**\n- Anzahl abgeschlossene Antworten\n- Anzahl in Bearbeitung\n- Abschlussrate in Prozent\n- Zeitraum\n\n**Pro Frage:**\n- Radio/Checkbox/Select → Balkendiagramm mit Prozentwerten\n- Zahl → Min, Max, Durchschnitt, Median, Summe\n- Matrix → Heatmap-Tabelle (farbkodiert)\n- Text/Textarea → scrollbare Liste der Freitext-Antworten\n- Datei → Anzahl hochgeladener Dateien\n\n**Einzelantworten:**\n- Tabelle mit Name, E-Mail, Datum, IP\n- Detail-Ansicht jeder Antwort\n- Einzelne Antworten löschen\n\n### CSV-Export\n\n- Button im Ergebnis-Dashboard\n- Eine Zeile pro Antwort, eine Spalte pro Frage\n- Matrix-Fragen werden in einzelne Spalten aufgeteilt (Zeile × Spalte)\n- Checkbox-Antworten mit Semikolon getrennt\n- UTF-8 mit BOM für Excel-Kompatibilität\n- Semikolon als Trennzeichen\n\n## Fragetypen im Detail\n\n### Text (einzeilig)\nEinfaches Textfeld. Optional mit Validierung: E-Mail, URL, Telefon.\n\n### Textarea (mehrzeilig)\nMehrzeiliges Textfeld für längere Antworten.\n\n### Zahl\nNumerisches Feld mit optionalem Min/Max.\n\n### Radio (Einfachauswahl)\nEine Antwort aus mehreren Optionen. Ideal für Ja/Nein-Fragen.\n\n### Checkbox (Mehrfachauswahl)\nMehrere Antworten aus einer Liste wählbar.\n\n### Select (Dropdown)\nDropdown-Auswahl, platzsparend bei vielen Optionen.\n\n### Matrix\nTabelle mit Zeilen (z.B. Berufsgruppen) und Spalten (z.B. Beteiligt/Nicht beteiligt). Pro Zeile wird eine Spalte gewählt (Radio-Buttons).\n\n### Datei-Upload\nErlaubt das Hochladen von PDF, JPG, PNG (max. 5 MB Standard). Dateien werden als WordPress-Anhänge gespeichert und nach konfigurierbarer Zeit automatisch gelöscht.\n\n## Skip-Logic\n\nSkip-Logic ermöglicht bedingte Verzweigungen:\n\n1. Bei einer Frage \"Skip-Regel\" hinzufügen\n2. Bedingung definieren: \"Wenn Antwort = [Wert]\"\n3. Ziel wählen: \"→ Springe zu Frage Y\"\n\nAlle übersprungenen Fragen werden ausgeblendet und bei Pflichtfeldprüfung ignoriert.\n\n## Öffentlicher Ergebnis-Link\n\nJede Umfrage hat einen eindeutigen Ergebnis-Token. Der Link hat das Format:\n\n```\nhttps://perfusiologie.de/umfrage-ergebnisse/{token}\n```\n\n**Wichtig:** Nach dem Aktivieren des Moduls einmal unter Einstellungen → Permalinks → Speichern klicken, damit die Rewrite-Rule aktiv wird.\n\nDer öffentliche Link zeigt:\n- Aggregierte Ergebnisse (Diagramme, Statistiken)\n- Keine Freitext-Antworten (Datenschutz)\n- Keine Einzelantworten oder personenbezogene Daten\n\n**Hinweis:** Der Ergebnis-Link ist auch für Entwurfs-Umfragen zugänglich (nur archivierte Umfragen sind ausgeschlossen).\n\n## Duplikatschutz\n\n**Cookie + IP (Standard):**\nBeim ersten Besuch wird ein Cookie gesetzt. Bei erneutem Aufruf prüft das System Cookie UND IP-Adresse. Wurde bereits eine abgeschlossene Antwort gefunden, wird statt des Formulars eine Danke-Meldung angezeigt.\n\n**Nur Cookie / Nur IP / Kein Schutz:**\nAlternative Modi, konfigurierbar pro Umfrage.\n\n## Zwischenspeichern\n\nWenn aktiviert, können Teilnehmer ihren Fortschritt speichern und später fortsetzen:\n- Button \"Zwischenspeichern\" im Formular\n- Antworten werden im Cookie zugeordnet\n- Beim nächsten Aufruf werden gespeicherte Antworten vorausgefüllt\n\n## ECLS-Zentren Umfrage\n\nVorkonfigurierte Musterumfrage mit 15 Fragen zur ECLS-Versorgung:\n\n1. Klinik-Name (Text, Pflicht)\n2. Ansprechpartner (Text, Pflicht)\n3. E-Mail (Text, E-Mail-Validierung, Pflicht)\n4. ECLS-Programm vorhanden? (Radio: Ja/Nein)\n5-14. Detailfragen zum ECLS-Programm (nur sichtbar wenn Q4 = \"Ja\", via Verschachtelung)\n15. Anmerkungen (Textarea)\n\n**Anlegen:** Im Admin unter Umfragen → Button \"ECLS-Zentren anlegen\". Die Umfrage wird als Entwurf erstellt und muss manuell auf \"Aktiv\" gesetzt werden.\n\n## Einstellungen\n\n**DGPTM Suite → Modul-Einstellungen → Umfragen:**\n\n- Standard-Duplikatschutz (Cookie+IP)\n- Maximale Dateigröße für Uploads (Standard: 5 MB)\n- Datei-Löschfrist (Standard: 90 Tage)\n- Umfrage-Seiten-ID (WordPress-Seite mit [dgptm_umfrage]-Shortcode für Token-URLs)\n\n## Verwendung Schritt für Schritt\n\n### Neue Umfrage erstellen (Admin)\n\n1. DGPTM Suite → Umfragen → Neue Umfrage\n2. Titel, Beschreibung und Einstellungen eintragen\n3. \"Umfrage speichern\" klicken\n4. Fragen hinzufügen (Typ wählen, Text eingeben, Optionen definieren)\n5. Optional: Verschachtelung konfigurieren (Elternfrage + Bedingung)\n6. \"Alle Fragen speichern\" klicken\n7. Status auf \"Aktiv\" setzen\n8. Shortcode `[dgptm_umfrage slug=\"...\"]` oder Token-URL verwenden\n\n### Neue Umfrage erstellen (Frontend-Editor)\n\n1. Frontend-Editor-Seite aufrufen\n2. \"Neue Umfrage\" klicken\n3. Titel und Einstellungen eintragen, speichern\n4. Fragen hinzufügen und konfigurieren\n5. Speichern\n\n### Ergebnisse auswerten\n\n1. Umfrage-Liste → Ergebnis-Icon klicken\n2. Übersicht mit Statistiken und Diagrammen prüfen\n3. Einzelantworten bei Bedarf einsehen\n4. CSV- oder PDF-Export für weitere Analyse\n5. Öffentlichen Link an Interessierte weitergeben\n\n## Technische Details\n\n- 4 Datenbanktabellen: `dgptm_surveys`, `dgptm_survey_questions`, `dgptm_survey_responses`, `dgptm_survey_answers`\n- Tabellen werden beim Modul-Laden automatisch erstellt (dbDelta)\n- v1.1 Spalten: `survey_token` (surveys), `parent_question_id`, `parent_answer_value` (questions)\n- AJAX-basiert: Admin-Speicherung und Frontend-Abgabe\n- Täglicher Cron-Job für Datei-Cleanup\n- Cookie-Laufzeit: 1 Jahr\n- CSV-Export: UTF-8 BOM, Semikolon-Trennung\n- PDF-Export: via FPDF-Bibliothek\n\n## Tipps\n\n- Umfrage zuerst als Entwurf erstellen und testen, bevor sie aktiv geschaltet wird\n- Abschnitts-Labels nutzen, um längere Umfragen übersichtlich zu strukturieren\n- Verschachtelung für Ja/Nein-Verzweigungen nutzen (z.B. Detailfragen nur bei \"Ja\")\n- Skip-Logic für größere Sprünge nutzen (z.B. zum Ende der Umfrage)\n- Nach Modulaktivierung Permalinks neu speichern (für öffentlichen Ergebnis-Link)\n- CSV-Export nutzt Semikolon → in Excel über \"Daten → Aus Text\" importieren\n- Matrix-Fragen eignen sich für Teamzusammensetzungen oder Bewertungsraster\n- Frontend-Editor für Benutzer einrichten, die keine Admin-Rechte benötigen",
    "features": [
        "8 Fragetypen (Text, Textarea, Zahl, Radio, Checkbox, Select, Matrix, Datei)",
        "Skip-Logic (bedingte Verzweigung)",
        "Fragen-Verschachtelung (mehrstufig)",
        "Token-basierte Umfrage-URLs",
        "Frontend-Editor für berechtigte Benutzer",
        "PDF-Export der Ergebnisse",
        "Duplikatschutz (Cookie + IP)",
        "Fortschrittsbalken mit Abschnitts-Navigation",
        "Zwischenspeichern und Fortsetzen",
        "Ergebnis-Dashboard mit Diagrammen",
        "CSV-Export",
        "Öffentlicher Ergebnis-Link",
        "Drag & Drop Fragen-Builder",
        "ECLS-Zentren Musterumfrage",
        "Datei-Upload mit automatischem Cleanup",
        "Berechtigungssystem (ACF-basiert)"
    ],
    "keywords": [
        "umfrage",
        "survey",
        "fragebogen",
        "ecls",
        "ecmo",
        "formular",
        "abstimmung",
        "erhebung",
        "befragung",
        "skip-logic",
        "verschachtelung",
        "nesting",
        "frontend-editor",
        "pdf-export",
        "token",
        "matrix",
        "csv-export",
        "ergebnisse"
    ],
    "module_id": "umfragen",
    "last_updated": "2026-02-11 12:00:00"
}
