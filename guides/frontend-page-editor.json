{
    "title": "Frontend Seiteneditor",
    "description": "Ermöglicht Benutzern die sichere Bearbeitung ausgewählter Seiten mit Elementor direkt aus dem Mitgliederbereich, ohne wp-admin-Zugriff. Mit 5-Schichten-Sicherheitssystem.",
    "content": "# Frontend Seiteneditor\n\n## Übersicht\n\nDas Frontend Seiteneditor-Modul ermöglicht es Benutzern, ausgewählte WordPress-Seiten mit Elementor zu bearbeiten, **komplett im Frontend ohne wp-admin**. Version 4.1.0 führt ein umfassendes 5-Schichten-Sicherheitssystem ein, das garantiert, dass Benutzer nur auf zugewiesene Seiten zugreifen können.\n\n## Hauptfunktionen\n\n- **5-Schichten-Sicherheitssystem** (NEU in v4.1.0)\n- **Direkter Elementor-Zugriff** ohne wp-admin\n- **ACF User-Meta Seitenzuweisung** für normale Benutzer\n- **Automatische Berechtigung** für Seiten-Autoren\n- **Rollenbasierte Berechtigungen** (Admin/Editor/Moderator)\n- **Temporäre Capabilities** (60 Minuten Session)\n- **Admin-Navigation blockiert** für erhöhte Sicherheit\n- **Zwei Shortcodes** für Liste und Zugriffsprüfung\n\n## Abhängigkeiten\n\n**Erforderlich:**\n- Elementor Plugin\n- Advanced Custom Fields (ACF) Plugin\n\n**WordPress:**\n- WordPress 5.8+\n- PHP 7.4+\n\n## NEU in Version 4.1.0: 5-Schichten-Sicherheitssystem\n\n### Schicht 1: Minimale Capabilities\n\nStatt `edit_pages` (Zugriff auf ALLE Seiten) erhalten Benutzer nur noch:\n- `upload_files` - Für Medien-Uploads in Elementor\n- `read` - Basis-Lesezugriff\n\n**Vorteil:** Keine uneingeschränkten Bearbeitungsrechte mehr!\n\n### Schicht 2: Backend-Zugriffssperre\n\nDie Funktion `restrict_backend_access()` blockiert:\n- Zugriff auf alle Admin-Bereiche außer `post.php`\n- Redirect zur zugewiesenen Seite bei falschen URLs\n- Prüfung ob die Seite wirklich zugewiesen ist\n\n**Vorteil:** Benutzer können nicht zu anderen Admin-Bereichen navigieren!\n\n### Schicht 3: Seiten-Bearbeitungsprüfung\n\nDer `map_meta_cap`-Filter prüft bei JEDER Bearbeitungsaktion:\n- Ist der Benutzer Author der Seite?\n- Ist die Seite über ACF zugewiesen?\n- Hat der Benutzer eine passende Rolle?\n\n**Vorteil:** Selbst bei direkten URLs werden fremde Seiten blockiert!\n\n### Schicht 4: Admin-Menü entfernen\n\nDie Funktion `hide_admin_menus()` entfernt:\n- Alle WordPress-Admin-Menüs\n- Dashboard, Medien, Seiten, etc.\n- Nur die aktuelle Seite bleibt sichtbar\n\n**Vorteil:** Kein Navigationsweg zu anderen Bereichen!\n\n### Schicht 5: JavaScript-Navigation blockieren\n\nEin spezielles JavaScript verhindert:\n- Clicks auf Admin-Bar-Links\n- Navigation zu anderen Admin-Bereichen\n- Öffnen von wp-admin in neuem Tab\n\n**Vorteil:** Auch technisch versierte Benutzer können nicht ausbrechen!\n\n## Shortcodes\n\n### [frontend_page_editor]\n\nZeigt die Liste aller bearbeitbaren Seiten für den aktuellen Benutzer.\n\n**Parameter:**\nKeine\n\n**Verwendung:**\n```\n[frontend_page_editor]\n```\n\n**Ausgabe:**\n- Karten-Grid mit allen zugewiesenen Seiten\n- \"Mit Elementor bearbeiten\"-Button (bei Elementor-Seiten)\n- \"Im Editor bearbeiten\"-Button (bei normalen Seiten)\n- \"Ansehen\"-Button zum Seiten-Preview\n- Badge \"Elementor\" für Elementor-fähige Seiten\n- Letzte Bearbeitung-Datum\n\n### [has_page_edit_access]\n\nGibt `1` oder `0` zurück, je nachdem ob der Benutzer Zugriff auf mindestens eine Seite hat.\n\n**Parameter:**\nKeine\n\n**Verwendung:**\n```\n[has_page_edit_access]\n```\n\n**Rückgabewerte:**\n- `1` = Benutzer hat Zugriff\n- `0` = Benutzer hat keinen Zugriff\n\n**Anwendungsfall:**\nKann mit Conditional Logic (z.B. in Elementor Pro) verwendet werden:\n```\nWenn [has_page_edit_access] = 1\n  → Zeige \"Meine Seiten bearbeiten\"-Link\nSonst\n  → Zeige \"Keine Bearbeitungsrechte\"\n```\n\n## Berechtigungssystem\n\n### Rollenbasierte Berechtigungen\n\n**1. Administratoren**\n- Haben automatisch Zugriff auf **alle Seiten** (inkl. Entwürfe)\n- Keine manuelle Zuweisung erforderlich\n- Sehen alle Seiten im Frontend-Editor\n- Voller wp-admin-Zugriff bleibt erhalten\n\n**2. Editoren & Moderatoren**\n- Haben automatisch Zugriff auf **alle veröffentlichten Seiten**\n- Keine manuelle Zuweisung erforderlich\n- Sehen alle veröffentlichten Seiten\n\n**3. Seiten-Autoren**\n- Benutzer die als **Author** einer Seite eingetragen sind\n- Haben automatisch Zugriff auf **ihre eigenen Seiten**\n- Keine manuelle Zuweisung erforderlich\n\n**4. Normale Benutzer**\n- Benötigen **manuelle Seitenzuweisung** über ACF User-Meta\n- Sehen nur zugewiesene Seiten + Seiten bei denen sie Author sind\n- Zuweisung erfolgt durch Administratoren\n- **NEU:** Können nur noch zugewiesene Seiten bearbeiten, keine anderen!\n\n### ACF User-Meta Feld\n\n**Feldname:** `editable_pages`\n**Typ:** Post Object (Mehrfachauswahl)\n**Post Type:** page\n**Sichtbarkeit:** Nur für Administratoren\n\n## Verwendung\n\n### Für Administratoren: Seiten zuweisen\n\n1. **WordPress Admin → Benutzer**\n2. **Benutzer auswählen → Bearbeiten**\n3. **Scrollen zu \"Bearbeitbare Seiten\"**\n4. **Seiten auswählen** (Mehrfachauswahl möglich)\n5. **\"Aktualisieren\" klicken**\n\n**Hinweis:** Das Feld erscheint nur bei Nicht-Admin-Benutzern.\n\n### Für Webmaster: Shortcode einbinden\n\n**Seite im Mitgliederbereich erstellen:**\n1. **Seiten → Neu hinzufügen**\n2. **Titel:** \"Meine Seiten bearbeiten\"\n3. **Shortcode einfügen:** `[frontend_page_editor]`\n4. **Veröffentlichen**\n5. **Seite nur für eingeloggte Benutzer sichtbar machen**\n\n**Optional: Bedingte Anzeige mit Elementor**\n1. **Button/Link-Widget hinzufügen**\n2. **Dynamic Content:** `[has_page_edit_access]`\n3. **Conditional Logic:**\n   - Zeige Widget wenn `[has_page_edit_access] = 1`\n4. **Link:** URL zur Seite mit `[frontend_page_editor]`\n\n### Für Benutzer: Seiten bearbeiten\n\n1. **Im Mitgliederbereich anmelden**\n2. **\"Meine Seiten bearbeiten\" aufrufen**\n3. **Liste der zugewiesenen Seiten wird angezeigt**\n4. **\"Mit Elementor bearbeiten\" klicken**\n5. **Automatischer Redirect zu Elementor**\n6. **Seite bearbeiten** (60 Minuten Edit-Session)\n7. **Änderungen speichern**\n8. **Fertig!**\n\n## Technische Details\n\n### Vergebene Capabilities (temporär)\n\n**NEU in v4.1.0:** Minimale Capabilities!\n\nWährend einer Edit-Session erhält der Benutzer nur noch:\n- `upload_files` - Für Medien in Elementor\n- `read` - Basis-Lesezugriff\n- `edit_post` - Nur für die EINE zugewiesene Seite\n- `elementor` - Elementor-Zugriff\n- `edit_with_elementor` - Elementor-Bearbeitung\n\n**Entfernt (Sicherheitsverbesserung):**\n- ❌ `edit_pages` (war zu weitreichend)\n- ❌ `edit_published_pages` (war zu weitreichend)\n\n### Session-Dauer\n\n- **Standard:** 60 Minuten\n- **Speicherung:** Transient + Cookie\n- **Auto-Verlängerung:** Nein\n- **Nach Ablauf:** Benutzer muss Link erneut klicken\n\n### Sicherheitsmechanismen\n\n**1. Nonce-Validierung**\n- Jeder Edit-Link enthält einen eindeutigen Nonce\n- Nonce ist seitenspezifisch und zeitlich begrenzt\n- Verhindert Cross-Site-Request-Forgery (CSRF)\n\n**2. Berechtigungsprüfung (5 Schichten)**\n- Minimale Capabilities\n- Backend-Zugriffssperre\n- Seiten-Bearbeitungsprüfung via map_meta_cap\n- Admin-Menü entfernen\n- JavaScript-Navigation blockieren\n\n**3. Session-Management**\n- Temporäre Edit-Session (60 Minuten)\n- Gespeichert in WordPress Transient\n- Backup in Cookie\n- Automatisches Verfallen\n\n## Styling\n\n**NEU:** DGPTM Brand Colors!\n\nDas Modul verwendet die offiziellen DGPTM-Farben:\n- **Primär:** #005792 (DGPTM-Dunkelblau)\n- **Primär-Hover:** #003d6b\n- **Grid-Layout** (responsive)\n- **Card-Design** für Seiten\n- **Mobile-optimiert**\n- **Accessibility-Features**\n\n### CSS-Anpassungen\n\nDatei: `css/frontend-page-editor.css`\n\n```css\n:root {\n    --fpe-primary: #005792;        /* DGPTM-Dunkelblau */\n    --fpe-primary-hover: #003d6b;\n    --fpe-elementor: #005792;\n}\n```\n\n## Häufige Anwendungsfälle\n\n### 1. Vereinsvorstand\n\n**Szenario:** Vereinsvorstände sollen ihre Vereinsseite selbst pflegen\n\n**Setup:**\n1. Seite \"Verein ABC\" erstellen\n2. User als Author der Seite setzen\n3. Automatischer Zugriff für User\n4. **Sicher:** User kann nur diese eine Seite bearbeiten\n\n### 2. Mitarbeiterprofile\n\n**Szenario:** Mitarbeiter pflegen ihre eigenen Profilseiten\n\n**Setup:**\n1. Für jeden Mitarbeiter eine Seite erstellen\n2. Mitarbeiter als Author setzen\n3. Mitarbeiter kann nur seine eigene Seite bearbeiten\n4. **Sicher:** Kein Zugriff auf andere Profile\n\n### 3. Externe Redakteure\n\n**Szenario:** Externe Redakteure sollen bestimmte Bereiche verwalten\n\n**Setup:**\n1. Redakteur-Account erstellen (ohne wp-admin-Zugriff)\n2. Admin weist spezifische Seiten zu\n3. Redakteur bearbeitet nur zugewiesene Seiten\n4. **Sicher:** Keine Navigation zu anderen Bereichen möglich\n\n### 4. Kunden-Portal\n\n**Szenario:** Kunden verwalten ihre Landing Pages selbst\n\n**Setup:**\n1. Pro Kunde eine Landing Page\n2. Kunde als Author oder via ACF zuweisen\n3. Kunde bearbeitet nur seine Page\n4. **Sicher:** Vollständige Isolation zwischen Kunden\n\n## Troubleshooting\n\n### Problem: Elementor öffnet sich nicht\n\n**Ursache:** Elementor nicht installiert oder deaktiviert\n\n**Lösung:**\n1. WordPress Admin → Plugins\n2. Elementor installieren/aktivieren\n3. Erneut versuchen\n\n### Problem: Benutzer sieht keine Seiten\n\n**Ursachen:**\n- Keine Seiten zugewiesen\n- Benutzer ist nicht Author\n- Benutzer hat keine passende Rolle\n\n**Lösung:**\n1. Als Admin: User-Profil öffnen\n2. Seiten im Feld \"Bearbeitbare Seiten\" zuweisen\n3. ODER: User als Author der Seite setzen\n4. ODER: User-Rolle auf Editor/Moderator ändern\n\n### Problem: \"Keine Berechtigung\"-Fehler\n\n**Ursachen:**\n- Session abgelaufen (60 Min)\n- Seite wurde nachträglich entzogen\n- Nonce ungültig\n- **NEU:** Benutzer versucht fremde Seite zu bearbeiten\n\n**Lösung:**\n1. Zurück zur Seiten-Liste\n2. Erneut auf \"Mit Elementor bearbeiten\" klicken\n3. Neue Session wird gestartet\n4. Prüfen ob Seite wirklich zugewiesen ist\n\n### Problem: \"Zugriff verweigert\" beim Speichern\n\n**Ursache:** v4.1.0 Sicherheitssystem blockiert unberechtigte Aktionen\n\n**Lösung:**\n- Normal! Das ist das Sicherheitssystem in Aktion\n- Benutzer kann nur zugewiesene Seiten speichern\n- Admin muss Seite erneut zuweisen\n\n## Best Practices\n\n### 1. Sicherheit zuerst\n\n- **NEU:** Vertrauen Sie dem 5-Schichten-System\n- Weisen Sie nur wirklich benötigte Seiten zu\n- Überprüfen Sie Zuweisungen regelmäßig\n- Nutzen Sie Author-Status für eigene Seiten\n\n### 2. Klare Seitenstruktur\n\n- Verwenden Sie sprechende Seitennamen\n- Organisieren Sie Seiten logisch\n- Nutzen Sie Seiten-Hierarchien\n\n### 3. Berechtigungen minimieren\n\n- Weisen Sie nur notwendige Seiten zu\n- Nutzen Sie Author-Status für eigene Seiten\n- Vermeiden Sie Übervergabe von Rechten\n\n### 4. Benutzer schulen\n\n- Zeigen Sie Benutzern den Workflow\n- Erklären Sie die 60-Minuten-Session\n- Informieren Sie über Sicherheitsbeschränkungen\n- Geben Sie Support-Kontakt an\n\n### 5. Backup vor Bearbeitung\n\n- Nutzen Sie Elementor-Revisionen\n- Erstellen Sie regelmäßige Backups\n- Testen Sie in Staging-Umgebung\n\n## Sicherheitshinweise\n\n**Was Benutzer KÖNNEN:**\n- Zugewiesene Seiten mit Elementor bearbeiten\n- Änderungen speichern und veröffentlichen\n- Seiten-Vorschau anzeigen\n- Medien hochladen (für ihre Seiten)\n\n**Was Benutzer NICHT können:**\n- ❌ Auf wp-admin zugreifen\n- ❌ Andere Seiten bearbeiten (selbst mit direkter URL!)\n- ❌ Zu anderen Admin-Bereichen navigieren\n- ❌ Plugins/Themes ändern\n- ❌ Benutzer verwalten\n- ❌ Einstellungen ändern\n- ❌ Admin-Menüs sehen\n- ❌ Nach 60 Min: Session verfällt automatisch\n\n**NEU in v4.1.0:**\n- ✅ Vollständige Isolation zwischen Benutzern\n- ✅ Kein Zugriff auf fremde Seiten möglich\n- ✅ JavaScript-Navigation blockiert\n- ✅ Backend-Zugriff komplett gesperrt\n- ✅ Nur minimale Capabilities vergeben\n\n## Changelog\n\n### Version 4.1.0 (2025-01-23)\n**Sicherheitsupdate:**\n- ✅ 5-Schichten-Sicherheitssystem implementiert\n- ✅ Minimale Capabilities (upload_files, read statt edit_pages)\n- ✅ Backend-Zugriffssperre hinzugefügt\n- ✅ Seiten-Bearbeitungsprüfung via map_meta_cap\n- ✅ Admin-Menüs werden komplett ausgeblendet\n- ✅ JavaScript-Navigation blockiert\n- ✅ Button-Farben auf DGPTM-Brand (#005792) aktualisiert\n- ✅ Sicherheitslücke geschlossen: Benutzer können nicht mehr auf fremde Seiten zugreifen\n\n### Version 4.0.0 (2025-01-22)\n- Modernisiertes Design\n- Responsives Grid-Layout\n- Verbesserte Benutzeroberfläche\n\n### Version 1.0.0 (Initial)\n- Initiales Release\n- Direkte Elementor-Bearbeitung ohne wp-admin\n- ACF User-Meta Seitenzuweisung\n- Rollenbasierte Berechtigungen\n- Session-Management mit Transients\n- Temporäre Capabilities (60 Min)\n- Shortcodes für Liste und Zugriffsprüfung\n\n## Technische Spezifikationen\n\n**Modul-ID:** `frontend-page-editor`\n**Kategorie:** Utilities\n**Version:** 4.1.0\n**Haupt-Datei:** `frontend-page-editor.php`\n**Dependencies:** Elementor, ACF\n**PHP:** 7.4+\n**WordPress:** 5.8+\n\n## Support\n\nBei Fragen oder Problemen:\n1. Prüfen Sie die Troubleshooting-Sektion\n2. Überprüfen Sie Browser-Console auf Fehler\n3. Testen Sie in anderem Browser\n4. Kontaktieren Sie den DGPTM-Support",
    "features": [
        "5-Schichten-Sicherheitssystem (NEU!)",
        "Minimale Capabilities für maximale Sicherheit",
        "Backend-Zugriffssperre",
        "JavaScript-Navigation blockiert",
        "Admin-Menüs komplett ausgeblendet",
        "Elementor-Bearbeitung komplett im Frontend",
        "ACF User-Meta Seitenzuweisung",
        "Rollenbasierte Berechtigungen",
        "Temporäre Capabilities (60 Min)",
        "Session-Management",
        "Zwei Shortcodes",
        "DGPTM Brand Design (#005792)"
    ],
    "keywords": [
        "elementor",
        "frontend-editor",
        "page-editor",
        "mitgliederbereich",
        "berechtigungen",
        "acf",
        "session",
        "capabilities",
        "sicherheit",
        "security",
        "isolation",
        "dgptm"
    ],
    "module_id": "frontend-page-editor",
    "generated_at": "2025-01-23 18:00:00",
    "last_updated": "2025-01-23 18:00:00",
    "version": "4.1.0"
}
